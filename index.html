<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>心战五子棋 · 极简未来开场 v3.0</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --neon: #00FFF0;
      --text: #E8FFFF;
    }

    html,
    body {
      height: 100%;
      margin: 0;
      background: #000;
      overflow: hidden;
      font-family: Inter, system-ui, Segoe UI, Roboto, Helvetica, Arial, PingFang SC, Hiragino Sans GB, Microsoft YaHei, sans-serif
    }

    #stage {
      position: fixed;
      inset: 0;
      display: block
    }

    .center {
      position: fixed;
      inset: 0;
      display: grid;
      place-items: center;
      pointer-events: none
    }

    .hero {
      pointer-events: auto;
      text-align: center
    }

    .logo {
      font-size: clamp(32px, 8vw, 88px);
      font-weight: 800;
      letter-spacing: .5px;
      line-height: 1.02;
      color: var(--text);
      filter: drop-shadow(0 8px 30px rgba(0, 255, 240, .2))
    }

    .subtitle {
      margin-top: 8px;
      color: #9AF7FF;
      letter-spacing: .14em;
      text-transform: uppercase;
      font-weight: 600
    }

    .cta {
      margin-top: 28px
    }

    .btn {
      border: 1px solid rgba(255, 255, 255, .18);
      background: rgba(255, 255, 255, .06);
      color: var(--text);
      padding: 12px 22px;
      border-radius: 14px;
      cursor: pointer;
      backdrop-filter: blur(12px);
      transition: transform .2s ease, background .2s ease
    }

    .btn:hover {
      transform: translateY(-2px);
      background: rgba(255, 255, 255, .12)
    }

    .sweep {
      position: fixed;
      inset: 0;
      pointer-events: none;
      mix-blend-mode: screen;
      background: linear-gradient(100deg, rgba(0, 255, 240, 0) 0%, rgba(0, 255, 240, .35) 50%, rgba(0, 255, 240, 0) 100%);
      transform: translateX(-120%);
      filter: blur(2px) drop-shadow(0 0 30px var(--neon));
      animation: sweep 3.6s cubic-bezier(.65, .02, .22, 1) 0.6s both
    }

    @keyframes sweep {
      to {
        transform: translateX(120%);
      }
    }

    .vignette {
      position: fixed;
      inset: 0;
      background: radial-gradient(60% 60% at 50% 50%, rgba(0, 255, 240, .10), transparent 60%);
      pointer-events: none;
      mix-blend-mode: screen;
      opacity: .6
    }

    .warp {
      position: fixed;
      inset: 0;
      pointer-events: none;
      opacity: 0
    }

    .warp::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 50% 50%, rgba(0, 255, 240, .55) 0%, rgba(0, 0, 0, .0) 40%, rgba(0, 0, 0, .95) 80%);
      transform: scale(0.2);
      filter: blur(10px);
      opacity: 0;
      transition: transform 1s cubic-bezier(.2, .7, .1, 1), opacity 1s ease
    }

    .warp.show {
      opacity: 1
    }

    .warp.show::before {
      transform: scale(3.8);
      opacity: 1
    }

    .flash {
      position: fixed;
      inset: 0;
      pointer-events: none;
      background: radial-gradient(circle at 50% 50%, rgba(255, 255, 255, .95), rgba(255, 255, 255, 0) 60%);
      opacity: 0;
      mix-blend-mode: screen;
    }

    .flash.show {
      animation: flash .22s ease-out forwards
    }

    @keyframes flash {
      0% {
        opacity: 0
      }

      20% {
        opacity: 1
      }

      100% {
        opacity: 0
      }
    }

    .hero {
      opacity: 0;
      transform: translateY(16px);
      animation: in .9s ease .9s both
    }

    @keyframes in {
      to {
        opacity: 1;
        transform: translateY(0)
      }
    }

    .leaving .hero {
      opacity: 0;
      transform: scale(.94) translateY(8px);
      transition: all .35s ease
    }

    .hud {
      position: fixed;
      bottom: 16px;
      left: 50%;
      transform: translateX(-50%);
      color: #79EFFF;
      font-size: 12px;
      opacity: .7
    }
  </style>
</head>

<body>
  <canvas id="stage"></canvas>
  <div class="sweep"></div>
  <div class="vignette"></div>

  <div class="center">
    <div class="hero" id="hero">
      <div class="logo">心战五子棋</div>
      <div class="subtitle">NEURO GOMOKU</div>
      <div class="cta"><button class="btn" id="enter">进入棋局</button></div>
    </div>
  </div>

  <div class="warp" id="warp"></div>
  <div class="flash" id="flash"></div>
  <div class="hud">点击 / 按 Enter 开始</div>

  <!-- 添加音频元素 -->
  <audio id="clickSound" preload="auto">
    <source src="a.wav" type="audio/wav">
  </audio>
  <audio id="enterSound" preload="auto">
    <source src="a.mp3" type="audio/mpeg">
  </audio>

  <script src="https://cdn.jsdelivr.net/npm/three@0.160.1/build/three.min.js"></script>

  <script>
    const canvas = document.getElementById('stage');
    const renderer = new THREE.WebGLRenderer({ canvas, antialias: true, powerPreference: 'high-performance' });
    renderer.setPixelRatio(Math.min(devicePixelRatio, 2));
    renderer.setSize(innerWidth, innerHeight);
    renderer.setClearColor(0x000000, 1);

    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(60, innerWidth / innerHeight, 0.1, 1000);
    camera.position.set(0, 0, 6);

    const PARTICLES = 420;
    const positions = new Float32Array(PARTICLES * 3);
    for (let i = 0; i < PARTICLES; i++) {
      const r = 2.6 + Math.random() * 1.8;
      const theta = Math.random() * Math.PI * 2;
      const phi = Math.acos(2 * Math.random() - 1);
      positions[i * 3 + 0] = r * Math.sin(phi) * Math.cos(theta);
      positions[i * 3 + 1] = r * Math.sin(phi) * Math.sin(theta);
      positions[i * 3 + 2] = r * Math.cos(phi);
    }
    const geo = new THREE.BufferGeometry();
    geo.setAttribute('position', new THREE.BufferAttribute(positions, 3));
    const mat = new THREE.PointsMaterial({ color: 0x00fff0, size: 0.035, sizeAttenuation: true, transparent: true, opacity: 0.75, depthWrite: false });
    const points = new THREE.Points(geo, mat);
    scene.add(points);
    const amb = new THREE.AmbientLight(0x00fff0, 0.08); scene.add(amb);

    const stoneGeo = new THREE.SphereGeometry(0.5, 48, 48);
    const blackMat = new THREE.MeshPhysicalMaterial({ color: 0x070707, roughness: 0.2, metalness: 0.1, reflectivity: 0.5, clearcoat: 0.6, clearcoatRoughness: 0.35 });
    const whiteMat = new THREE.MeshPhysicalMaterial({ color: 0xffffff, roughness: 0.2, metalness: 0.0, reflectivity: 0.9, clearcoat: 0.8, clearcoatRoughness: 0.25 });
    const blackStone = new THREE.Mesh(stoneGeo, blackMat);
    const whiteStone = new THREE.Mesh(stoneGeo, whiteMat);
    blackStone.visible = false; whiteStone.visible = false;
    scene.add(blackStone); scene.add(whiteStone);

    const rim = new THREE.DirectionalLight(0x00fff0, 0.7); rim.position.set(-2, 2, 4); scene.add(rim);

    let t = 0, leavingUI = false, warping = false, stonesActive = false, collided = false;
    function tick() {
      t += 0.016;
      points.rotation.y += 0.0009;
      points.rotation.x = Math.sin(t * 0.12) * 0.02;
      const s = 1 + Math.sin(t * 0.5) * 0.005; points.scale.set(s, s, s);

      if (stonesActive) {
        blackStone.rotation.y += 0.03; whiteStone.rotation.y -= 0.03;
        blackStone.position.x += 0.06; whiteStone.position.x -= 0.06;
        blackStone.position.y = Math.sin((blackStone.position.x + 2) * 1.2) * 0.06;
        whiteStone.position.y = Math.sin((2 - whiteStone.position.x) * 1.2) * 0.06;
        if (!collided && Math.abs(blackStone.position.x - whiteStone.position.x) < 0.15) {
          collided = true;
          triggerFlash();
          setTimeout(() => { startWarp(); }, 120);
        }
      }
      renderer.render(scene, camera);
      requestAnimationFrame(tick);
    }
    tick();

    const btn = document.getElementById('enter');
    const warp = document.getElementById('warp');
    const flash = document.getElementById('flash');
    const hero = document.getElementById('hero');
    const clickSound = document.getElementById('clickSound');
    const enterSound = document.getElementById('enterSound');

    // 全局点击音效
    document.addEventListener('click', function () {
      clickSound.currentTime = 0;
      clickSound.play().catch(e => console.log('点击音效播放失败:', e));
    });

    function triggerFlash() { flash.classList.remove('show'); void flash.offsetWidth; flash.classList.add('show'); }
    function startStones() {
      blackStone.visible = true; whiteStone.visible = true;
      blackStone.position.set(-2.2, 0, 0); whiteStone.position.set(2.2, 0, 0);
      stonesActive = true;
      setTimeout(() => {
        location.href = '/a.html'
      }, 2000)
    }
    function startWarp() {
      if (warping) return; warping = true;
      warp.classList.add('show');
      const iv = setInterval(() => { camera.position.z = Math.max(2.2, camera.position.z - 0.08); }, 16);
      setTimeout(() => { clearInterval(iv); window.dispatchEvent(new CustomEvent('INTRO_FINISHED')); }, 1100);
    }
    function enter() {
      if (leavingUI) return; leavingUI = true;
      // 播放进入棋局音效
      enterSound.currentTime = 0;
      enterSound.play().catch(e => console.log('进入音效播放失败:', e));
      document.body.classList.add('leaving');
      setTimeout(() => { hero.style.display = 'none'; startStones(); }, 220);
    }
    btn.addEventListener('click', enter);
    window.addEventListener('keydown', (e) => { if (e.key === 'Enter') enter(); });
    window.addEventListener('resize', () => { camera.aspect = innerWidth / innerHeight; camera.updateProjectionMatrix(); renderer.setSize(innerWidth, innerHeight); });
  </script>
</body>

</html>